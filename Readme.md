
# Financial Diary API

API для ведения финансового учета с возможностью аутентификации пользователей и работы с финансовыми счётами.

## Данные для аутентификации

- **Обычный пользователь**:
  - email: `example@mail.ru`
  - password: `Test_user12345`
  
- **Администратор**:
  - email: `example_admin@mail.ru`
  - password: `Admin_test_password12345`

**Примечание**: Для создания пользователя требуется реальный email, так как проверка происходит через SMTP запрос. Если email не существует, будет выведено сообщение "Неверный формат email".

---

## Запуск с помощью Docker Compose

1. **Клонируйте проект** на ваш локальный компьютер.
2. **Откройте терминал** в корне проекта.
3. Запустите контейнеры с помощью одной из следующих команд:

   - Если у вас есть возможность использовать Makefile:
     ```bash
     make app
     ```

   - Если Makefile не доступен, используйте команду для запуска через Docker Compose:
     ```bash
     docker compose -f docker_compose/app.yaml -f docker_compose/storage.yaml --env-file ../DimaTechTest/.env_docker up -d --force-recreate --build
     ```

4. После успешного запуска сервисов, откройте браузер и перейдите по следующему URL:
   ```
   http://127.0.0.1:8345/docs
   ```

---

## Примечания по дебагу

Для отладки и мониторинга работы контейнеров доступны следующие команды:

- **Просмотр логов базы данных**:
  ```bash
  make storages-logs
  ```

- **Просмотр логов приложения**:
  ```bash
  make app-logs
  ```

- **Остановка всех контейнеров (БД и приложение)**:
  ```bash
  make app-down
  ```

- **Остановка контейнера только с базой данных**:
  ```bash
  make storages-down
  ```

- **Открытие терминала PostgreSQL**:
  ```bash
  make postgres
  ```

- **Запуск контейнеров БД и приложения**:
  ```bash
  make app
  ```

---

## Запуск без Docker Compose

1. **Клонируйте проект** на ваш локальный компьютер.
2. **Откройте терминал** в корне проекта.
3. Откройте файл конфигурации `app/config.py` и в строке 21 замените `.env_docker` на `.env`:
   ```python
   env_file=".env"
   ```

4. При необходимости, отредактируйте файл `.env` с вашими данными PostgreSQL.
5. Установите зависимости с помощью Poetry. Если Poetry не установлен, выполните команду:
   ```bash
   pip install poetry
   ```
   Если Poetry уже установлен, просто выполните:
   ```bash
   poetry install
   ```

6. Примените миграции базы данных:
   ```bash
   alembic upgrade head
   ```

7. Запустите приложение:

   - Для Windows:
     ```bash
     py app/main.py
     ```

   - Для Linux:
     ```bash
     python3 app/main.py
     ```

8. После запуска приложения откройте браузер и перейдите по следующему URL:
   ```
   http://localhost:8000/docs
   ```

---

## Описание API

Документация для использования API доступна по адресу:
```
http://127.0.0.1:8345/docs (docker-compose)
http://localhost:8000/docs (без docker-compose)
```
